name: Build InstaBoost Pro APK

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
  release:
    types: [published]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
        
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
      
    - name: Cache Gradle packages
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
          
    - name: Build with Gradle
      run: ./gradlew assembleDebug
      
    - name: Upload APK as artifact
      uses: actions/upload-artifact@v4
      with:
        name: InstaBoost-Pro-Debug
        path: app/build/outputs/apk/debug/app-debug.apk
        retention-days: 30
        
    - name: Create Release
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: softprops/action-gh-release@v1
      with:
        files: app/build/outputs/apk/debug/app-debug.apk
        tag_name: v${{ github.run_number }}
        name: InstaBoost Pro v${{ github.run_number }}
        body: |
          ## ğŸš€ InstaBoost Pro - Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯
          
          ### âœ¨ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
          - ØªØ­Ø³ÙŠÙ†Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          - Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
          - ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
          - ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
          
          ### ğŸ“± ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ«Ø¨ÙŠØª:
          1. Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù APK Ø£Ø¯Ù†Ø§Ù‡
          2. ÙØ¹Ù‘Ù„ "ØªØ«Ø¨ÙŠØª Ù…Ù† Ù…ØµØ§Ø¯Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©" ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ
          3. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ù…Ù„Ù APK Ù„Ù„ØªØ«Ø¨ÙŠØª
          4. Ø§ØªØ¨Ø¹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          
          ### ğŸ”§ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
          - Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
          - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†
          - Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø¹Ø±Ø¶
          
          ### ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
          - Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¢Ù…Ù† 100%
          - ÙŠØ­ØªØ§Ø¬ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
          - ÙŠØ¹Ù…Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
          
          ---
          
          **ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© GitHub Actions**
          **ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ù†Ø§Ø¡:** ${{ github.event.head_commit.timestamp }}
        draft: false
        prerelease: false
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Comment on PR
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ APK Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† Artifacts.'
          }) 